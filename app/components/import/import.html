<div class="import row" (dragover)="false" (dragleave)="false" (drop)="false">
    <div class="col">
        <div class="row">
            <div class="col default-nav bg-light text-right">
                <button id="importStartButton"
                        class="btn btn-primary"
                        [ngClass]="{ 'disabled': !isReady() }"
                        (click)="!isReady() || startImport()">
                    <span class="mdi mdi-file-import"></span>
                    <span class="button-label" i18n="@@import.startImport">Import starten</span>
                </button>
            </div>
        </div>

        <div class="row">
            <div class="form-group col default-container">
                <div class="col-lg-6 mx-lg-auto py-4">

                    <div class="form-group">
                        <label class="control-label col-form-label"
                               for="importFormatSelect" i18n="@@import.format">Format</label>
                        <select id="importFormatSelect" class="form-control"
                                [(ngModel)]="format" (change)="onFormatChange()">
                            <option value="native" i18n="@@import.formats.native">JSONL</option>
                            <option value="csv" i18n="@@import.formats.csv">CSV</option>
                            <option value="geojson" i18n="@@import.formats.geoJson">GeoJSON</option>
                            <option value="shapefile" i18n="@@import.formats.shapefile">Shapefile</option>
                            <option *ngIf="isTestProject()" value="idig"
                                    i18n="@@import.formats.iDig">iDig (experimentell) – CSV</option>
                            <option *ngIf="isMeninxProject()" value="meninxfind"
                                    i18n="@@import.formats.meninx">Meninx/Funde (experimentell) – CSV</option>
                        </select>
                    </div>

                    <div class="form-group">
                        <label class="control-label col-form-label" for="importSourceSelect"
                               i18n="@@import.source">Quelle</label>
                        <select id="importSourceSelect" class="form-control"
                                [(ngModel)]="sourceType"
                                (ngModelChange)="reset()">
                            <option value="file" i18n="@@import.file">Datei</option>
                            <option *ngIf="format !== 'shapefile'" value="http"
                                    i18n="@@import.http">HTTP</option>
                        </select>
                    </div>

                    <div *ngIf="sourceType === 'file'" class="form-group">
                        <label class="control-label col-form-label" i18n="@@import.path">Pfad</label>

                        <div class="input-group">
                            <input [ngModel]="file ? file.path : ''" class="form-control"
                                   placeholder="Datei auswählen..."
                                   i18n-placeholder="@@import.chooseFile"
                                   disabled>
                            <input id="import-file-input" class="file-input" type="file"
                                   accept="{{getFileInputExtensions()}}"
                                   (change)="selectFile($event)">
                            <label for="import-file-input" class="btn btn-secondary file-input-label">
                                <span class="mdi mdi-folder"></span>
                            </label>
                        </div>
                    </div>

                    <div *ngIf="sourceType === 'http'" class="form-group">
                        <label class="control-label col-form-label" i18n="@@import.url">URL</label>
                        <input class="form-control" id="importUrlInput"
                               type="text"
                               [(ngModel)]="url">
                    </div>

                    <div class="form-group" *ngIf="format === 'csv' && file && !typeFromFileName">
                        <label class="control-label col-form-label"
                               for="importTypeSelect"
                               i18n="@@import.format.importTypeSelect">Ressourcentyp</label>

                        <select id="importTypeSelect" class="form-control"
                                [(ngModel)]="selectedType">

                            <option *ngFor="let t of resourceTypes" [ngValue]="t">
                                {{t.label}}
                            </option>
                        </select>
                    </div>

                    <div *ngIf="showMergeOption()" class="form-group form-check-inline">
                        <input type="checkbox" id="merging-checkbox" class="form-check-input"
                               [(ngModel)]="allowMergingExistingResources">
                        <label for="merging-checkbox" class="form-check-label" i18n="@@import.mergeOption.label">
                            Vorhandene Ressourcen ergänzen
                        </label>
                    </div>

                    <div *ngIf="showMergeOption()" class="import-info" i18n="@@import.mergeOption.info">
                        Ist diese Option aktiviert, so werden bereits existierende Datensätze mit
                        den Daten aus der Importdatei ergänzt. Felder des Importdatensatzes überschreiben
                        dabei gleichnamige Felder im existierenden Datensatz. Geometrien des Importdatensatzes
                        überschreiben bestehende im existierenden Datensatz. Im existierenden Datensatz vorhandene Felder,
                        die nicht im Importdatensatz vorhanden sind, bleiben unverändert bestehen.
                        Der Ressourcentyp kann nicht verändert werden. Die Zuordnung von Datensätzen
                        geschieht per Bezeichner (Feld <em>identifier</em>).
                    </div>

                    <div *ngIf="showMergeRelationsOption()" class="form-group form-check-inline">
                        <input type="checkbox" id="merging-relations-checkbox" class="form-check-input"
                               [(ngModel)]="allowUpdatingRelationOnMerge">
                        <label for="merging-relations-checkbox" class="form-check-label" i18n="@@import.mergeOption.relationsLabel">
                            Relationen überschreiben
                        </label>
                    </div>

                    <div *ngIf="showMergeRelationsOption()" class="import-info" i18n="@@import.mergeOption.relationsInfo">
                        Ist diese Option aktiviert, so können auch die Relationen neu gesetzt werden.
                        Nicht im Importdatensatz gesetzte Relationen werden dabei entfernt.
                    </div>

                    <div class="form-group" *ngIf="showImportIntoOperation()">
                        <label class="control-label col-form-label"
                               for="operationSelect"
                               i18n="@@import.assignToOperation.label">Daten einer Maßnahme zuordnen</label>
                        <select id="operationSelect" class="form-control"
                                [(ngModel)]="selectedOperationId">
                            <option value="" i18n="@@import.assignToOperation.noAssignment">Keine Zuordnung</option>
                            <option *ngFor="let document of operations" value="{{document.resource.id}}">
                                {{getDocumentLabel(document)}}
                            </option>
                        </select>
                    </div>

                    <div *ngIf="format === 'csv'" class="form-group">
                        <label class="control-label col-form-label"
                               i18n="@@import.csv.separator">Feldtrennzeichen</label>
                        <input class="form-control" id="separatorInput"
                               type="text" [maxlength]="1" [(ngModel)]="separator">
                    </div>

                    <div *ngIf="format === 'geojson'" class="import-info" i18n="@@import.geojson.info">
                        Beim GeoJSON-Import werden keine neuen Ressourcen angelegt, sondern existierenden
                        Ressourcen Geometrien hinzugefügt. Bitte beachten Sie, dass bereits vorhandene
                        Geometrien dabei überschrieben werden. Die Zuordnung von Datensätzen geschieht per
                        Bezeichner (Feld <em>identifier</em> im Objekt <em>properties</em>). Datensätze in der
                        Importdatei, die nicht zugeordnet werden können, werden ignoriert.
                    </div>

                    <div *ngIf="isJavaInstallationMissing()" class="import-info text-danger" i18n="@@import.shapefile.javaWarning">
                        Zur Durchführung eines Shapefile-Imports ist die Installation von Java 8 oder höher
                        erforderlich.
                    </div>

                    <div *ngIf="format === 'shapefile' && !isJavaInstallationMissing()" class="import-info" i18n="@@import.shapefile.info">
                        Beim Shapefile-Import werden keine neuen Ressourcen angelegt, sondern existierenden
                        Ressourcen Geometrien hinzugefügt. Bitte beachten Sie, dass bereits vorhandene
                        Geometrien dabei überschrieben werden. Die Zuordnung von Datensätzen geschieht per
                        Bezeichner (Feld <em>identifier</em>). Datensätze im Shapefile, die nicht zugeordnet
                        werden können, werden ignoriert.
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
