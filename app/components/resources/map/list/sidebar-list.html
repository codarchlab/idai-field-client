<context-menu *ngIf="contextMenuPosition"
              [position]="contextMenuPosition"
              (onSelectAction)="performContextMenuAction($event)"></context-menu>


<div *ngIf="isPopoverMenuOpened()" id="sidebar-popover">

    <div *ngIf="isPopoverMenuOpened('children')" class="sidebar-popover-page">
        <children-view [document]="viewFacade.getSelectedDocument()"></children-view>
    </div>

    <div *ngIf="isPopoverMenuOpened('info')" class="sidebar-popover-page">
        <div class="sidebar-popover-header">
            <div class="btn btn-light left"
                 [class.active]="getExpandAllGroups()"
                 (click)="tooltip.close(); toggleExpandAllGroups()"
                 ngbTooltip="Alle Gruppen ausklappen"
                 i18n-ngbTooltip="@@resources.sidebarList.expandAllGroups"
                 #tooltip="ngbTooltip"
                 placement="right"
                 container="body"
                 triggers="manual"
                 (mouseover)="tooltip.open()"
                 (mouseleave)="tooltip.close()">
                <span class="mdi mdi-unfold-more-horizontal"></span>
            </div>
            <div>{{viewFacade.getSelectedDocument().resource.identifier}}</div>
            <div class="btn btn-light right" (click)="closePopover()">
                <span class="mdi mdi-close"></span>
            </div>
        </div>

        <thumbnail [identifier]="viewFacade.getSelectedDocument().resource.identifier"
                   [isDepictedInRelations]="viewFacade.getSelectedDocument().resource.relations['isDepictedIn']">
        </thumbnail>

        <div id="document-info" [class.short-document-info]="hasThumbnail(viewFacade.getSelectedDocument())">
            <fields-view
                    [expandAllGroups]="getExpandAllGroups()"
                    [resource]="viewFacade.getSelectedDocument().resource"
                    (onJumpToResource)="jumpToResource($event)"
                    (onSectionToggled)="disableExpandAllGroups()"></fields-view>
        </div>
    </div>
</div>

<ul #sidebar id="sidebar" class="resources-listing" [class.scrollbar-visible]="isScrollbarVisible(sidebar)"
    tabindex="0" (scroll)="closeContextMenu()" (keydown)="onKeyDown($event)">
    <li *ngFor="let document of viewFacade.getDocuments()"
        class="resources-listing-item resources-listing-item-wide"
        (mouseover)="highlightDocument(document)"
        (mouseleave)="highlightedDocument = undefined"
        (contextmenu)="openContextMenu($event, document)"
        [class.new-from-remote]="viewFacade.isNewDocumentFromRemote(document)"
        [class.conflicted]="document['_conflicts']"
        [class.selected]="viewFacade.getSelectedDocument()
                && viewFacade.getSelectedDocument().resource.id === document.resource.id"
        [id]="'resource-' + document.resource.identifier">

        <sidebar-list-button-group [document]="document"></sidebar-list-button-group>

        <document-teaser
                (click)="select(document)"
                (dblclick)="editDocument(document)"
                [document]="document"></document-teaser>
    </li>
</ul>

<plus-button *ngIf="isPlusButtonShown()" id="create-document-button" [placement]="'top'"
             [preselectedType]="getCurrentFilterType()"
             [liesWithin]="getSelectedSegmentDoc()"
             [isRecordedIn]="viewFacade.getCurrentOperation()"
             [status]="getPlusButtonStatus()"></plus-button>
<loading-icon></loading-icon>