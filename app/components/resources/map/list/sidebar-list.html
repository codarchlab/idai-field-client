<context-menu *ngIf="contextMenuPosition"
              [position]="contextMenuPosition"
              (onSelectAction)="performContextMenuAction($event)"></context-menu>


<div *ngIf="isPopoverMenuOpened()" id="sidebar-popover">

    <div *ngIf="isPopoverMenuOpened('children')" class="sidebar-popover-page">
        <children-view [document]="viewFacade.getSelectedDocument()"></children-view>
    </div>

    <div *ngIf="isPopoverMenuOpened('info')" class="sidebar-popover-page">
        <div class="sidebar-popover-header">
            <div>{{viewFacade.getSelectedDocument().resource.identifier}}</div>
            <div class="btn btn-light" (click)="closePopover()">
                <span class="mdi mdi-close"></span>
            </div>
        </div>

        <thumbnail [identifier]="viewFacade.getSelectedDocument().resource.identifier"
                   [isDepictedInRelations]="viewFacade.getSelectedDocument().resource.relations['isDepictedIn']">
        </thumbnail>

        <div id="document-info" [class.short-document-info]="hasThumbnail(viewFacade.getSelectedDocument())">
            <fields-view [resource]="viewFacade.getSelectedDocument().resource"
                         (onJumpToResource)="jumpToResource($event)"></fields-view>
        </div>
    </div>
</div>

<ul #sidebar id="sidebar" class="resources-listing" [class.scrollbar-visible]="isScrollbarVisible(sidebar)"
    (scroll)="closeContextMenu()">
    <li *ngFor="let document of viewFacade.getDocuments()"
        class="resources-listing-item resources-listing-item-wide"
        (mouseover)="highlightDocument(document)"
        (mouseleave)="highlightedDocument = undefined"
        (contextmenu)="openContextMenu($event, document)"
        [class.new-from-remote]="viewFacade.isNewDocumentFromRemote(document)"
        [class.conflicted]="document['_conflicts']"
        [class.selected]="viewFacade.getSelectedDocument()
                && viewFacade.getSelectedDocument().resource.id === document.resource.id"
        [id]="'resource-' + document.resource.identifier">

        <sidebar-list-button-group [document]="document"></sidebar-list-button-group>

        <document-teaser
                (click)="select(document)"
                (dblclick)="editDocument(document)"
                [document]="document"></document-teaser>
    </li>

    <li *ngIf="isDocumentLimitExceeded()" id="document-limit-info" i18n="@@resources.sidebarList.resourceLimitInfo">
        Es werden die ersten {{viewFacade.getDocuments().length}} von {{viewFacade.getTotalDocumentCount()}}
        Ressourcen angezeigt. Schränken Sie die Suche weiter ein oder verlassen Sie den erweiterten Suchmodus,
        um auf die übrigen Ressourcen zuzugreifen.
        <br><br><br>
    </li>
</ul>

<plus-button *ngIf="isPlusButtonShown()" id="create-document-button" [placement]="'top'"
             [preselectedType]="getCurrentFilterType()"
             [liesWithin]="getSelectedSegmentDoc()"
             [isRecordedIn]="viewFacade.getCurrentOperation()"
             [status]="getPlusButtonStatus()"></plus-button>
<loading-icon></loading-icon>